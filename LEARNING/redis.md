## * 持久化

#### * RDB

* RDB持久化以指定时间间隔执行数据集的时间点快照，以文件的形式写到磁盘上,文件名dump.rdb
* 配置：redis.conf : save 3600 1 300 100 60 10000
* 手动备份

  * save
  * bgsave
* bgsave执行原理![1729172719291](image/redis/1729172719291.png)
* COW内存回收

  * 内核提供的写时复制机制避免了大量内存拷贝以及占用过多内存
  * 子进程fork操作只是拷贝了父进程的页表数据，当fork完成后，对于一个父进程引用的内存页，其引用值从1变成2.
  * 当父进程进行写操作时，会申请一份新的内存页，并从原内存页copy所有数据，之后父进程就在新的内存页上进行操作。而原内存页就变成了子进程的**专属内存页**，引用值变成了1
  * 子进程重写完成并退出后，内核会对资源进行回收，包括占用的内存资源
  * 回收：对于页表来说，是进程专属，直接清理即可；而关联的内存页会将其引用值减1，如果引用值变成了0，该内存页就会被回收
  * 也就是复制之前的页（原内存页），变成了子进程的专属页，当子进程结束后就会被回收掉
